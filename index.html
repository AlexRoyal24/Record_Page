<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Record_Pages</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#eef3f8;
    padding:20px;
}
.hidden{display:none;}
.card{
    background:white;
    padding:15px;
    margin-bottom:15px;
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,.15);
}
button{
    background:#1976d2;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:5px;
    cursor:pointer;
}
button:hover{background:#0f5ca8;}
input,textarea{
    width:100%;
    padding:5px;
    margin:4px 0;
}
canvas{
    width:100%;
    height:200px;
}
label{
    font-size:14px;
}
</style>
</head>

<body>

<h1>Registro de Nataci√≥n</h1>

<!-- LOGIN -->
<div id="login" class="card">
    <h2>Ingreso Profesores</h2>
    <input type="password" id="pass" placeholder="Clave del profesor">
    <button onclick="login()">Ingresar</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
    <div id="profesores"></div>
</div>

<script>
const dias=["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"];

// üîê CONFIGURACI√ìN DE PROFESORES (EDITAR SOLO AQU√ç)
const profesoresConfig = [
    { nombre:"Profesor 1", clave:"prof1" },
    { nombre:"Profesor 2", clave:"prof2" },
    { nombre:"Profesor 3", clave:"prof3" }
];

let profesorActivo = null;

// DATOS
let data = JSON.parse(localStorage.getItem("natacionData")) || {
    profesores: profesoresConfig.map(p => ({
        nombre: p.nombre,
        alumnos: []
    }))
};

function save(){
    localStorage.setItem("natacionData", JSON.stringify(data));
}

// LOGIN
function login(){
    const clave = document.getElementById("pass").value;
    const index = profesoresConfig.findIndex(p => p.clave === clave);

    if(index === -1){
        alert("Clave incorrecta");
        return;
    }

    profesorActivo = index;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    render();
}

// RENDER SOLO DEL PROFESOR ACTIVO
function render(){
    const cont = document.getElementById("profesores");
    cont.innerHTML = "";

    const p = data.profesores[profesorActivo];

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
        <h2>${p.nombre}</h2>
        <button onclick="addAlumno()">‚ûï Alumno</button>
        <div id="alumnos"></div>
    `;
    cont.appendChild(div);

    p.alumnos.forEach((a,ai)=>renderAlumno(ai));
}

function addAlumno(){
    data.profesores[profesorActivo].alumnos.push({
        nombre:"Alumno",
        metros:[0,0,0,0,0,0,0],
        comentario:""
    });
    save();
    render();
}

function renderAlumno(ai){
    const a = data.profesores[profesorActivo].alumnos[ai];
    const cont = document.getElementById("alumnos");

    const totalSemana = a.metros.reduce((x,y)=>x+y,0);
    const totalMes = totalSemana * 4;

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
        <input value="${a.nombre}" onchange="updateName(${ai},this.value)">

        ${dias.map((d,i)=>`
            <label>${d}
                <input type="number" value="${a.metros[i]}"
                onchange="updateMetro(${ai},${i},this.value)">
            </label>
        `).join("")}

        <canvas id="chart-${ai}"></canvas>

        <p><b>Total semanal:</b> ${totalSemana} m</p>
        <p><b>Total mensual:</b> ${totalMes} m</p>

        <textarea placeholder="Comentario para el pr√≥ximo d√≠a"
        onchange="updateComment(${ai},this.value)">${a.comentario}</textarea>

        <button onclick="downloadPDF(${ai})">‚¨á Descargar PDF</button>
    `;
    cont.appendChild(div);

    drawChart(`chart-${ai}`, a.metros);
}

function updateName(a,val){
    data.profesores[profesorActivo].alumnos[a].nombre = val;
    save();
}

function updateMetro(a,i,val){
    data.profesores[profesorActivo].alumnos[a].metros[i] = Number(val);
    save();
    render();
}

function updateComment(a,val){
    data.profesores[profesorActivo].alumnos[a].comentario = val;
    save();
}

// GR√ÅFICA DE L√çNEA
function drawChart(id,vals){
    const c = document.getElementById(id);
    const ctx = c.getContext("2d");
    c.width = c.offsetWidth;
    c.height = 200;
    ctx.clearRect(0,0,c.width,c.height);

    const max = Math.max(...vals, 10);
    ctx.beginPath();
    ctx.strokeStyle = "#1976d2";
    ctx.lineWidth = 2;

    vals.forEach((v,i)=>{
        const x = (c.width/6) * i;
        const y = c.height - (v/max * c.height);
        i === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    });
    ctx.stroke();
}

// PDF
function downloadPDF(a){
    const al = data.profesores[profesorActivo].alumnos[a];
    const total = al.metros.reduce((x,y)=>x+y,0);

    const w = window.open("");
    w.document.write(`
        <h1>Reporte de Nataci√≥n</h1>
        <p><b>Profesor:</b> ${data.profesores[profesorActivo].nombre}</p>
        <p><b>Alumno:</b> ${al.nombre}</p>
        <p><b>Total semanal:</b> ${total} m</p>
        <p><b>Total mensual:</b> ${total*4} m</p>
        <p><b>Comentario:</b> ${al.comentario}</p>
        <p><b>Fecha:</b> ${new Date().toLocaleDateString()}</p>
    `);
    w.print();
}
</script>

</body>
</html>
