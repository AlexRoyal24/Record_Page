<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Record_Pages</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:20px;
}
h2,h3{
    margin-top:0;
}
input, button{
    padding:8px;
    margin:5px 0;
}
button{
    cursor:pointer;
}
.hidden{
    display:none;
}
.card{
    background:#fff;
    padding:15px;
    margin-bottom:15px;
    border-radius:8px;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.alumno{
    border-left:5px solid #2196f3;
}
canvas{
    max-width:100%;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
    <h2>Ingreso de Profesor</h2>
    <input type="password" id="password" placeholder="Contrase침a">
    <br>
    <button onclick="login()">Ingresar</button>
</div>

<!-- PANEL -->
<div id="panel" class="hidden">
    <h2 id="profName"></h2>
    <button onclick="logout()">Cerrar sesi칩n</button>

    <div class="card">
        <h3>Agregar alumno</h3>
        <input type="text" id="newAlumno" placeholder="Nombre del alumno">
        <br>
        <button onclick="addAlumno()">Crear alumno</button>
    </div>

    <div id="alumnos"></div>
</div>

<script>
/* CONFIG PROFESORES */
const profesores = {
    prof1: "Profesor 1",
    prof2: "Profesor 2",
    prof3: "Profesor 3"
};

let profesorActual = null;

/* DATA */
let data = JSON.parse(localStorage.getItem("natacionData")) || {
    profesores:{
        prof1:[],
        prof2:[],
        prof3:[]
    }
};

function save(){
    localStorage.setItem("natacionData", JSON.stringify(data));
}

/* LOGIN */
function login(){
    const pass = document.getElementById("password").value;
    if(profesores[pass]){
        profesorActual = pass;
        document.getElementById("login").classList.add("hidden");
        document.getElementById("panel").classList.remove("hidden");
        document.getElementById("profName").innerText = profesores[pass];
        renderAlumnos();
    }else{
        alert("Contrase침a incorrecta");
    }
}

function logout(){
    location.reload();
}

/* ALUMNOS */
function addAlumno(){
    const nombre = document.getElementById("newAlumno").value.trim();
    if(!nombre) return;
    data.profesores[profesorActual].push({
        nombre,
        registros:[],
        comentario:""
    });
    document.getElementById("newAlumno").value="";
    save();
    renderAlumnos();
}

function renderAlumnos(){
    const cont = document.getElementById("alumnos");
    cont.innerHTML="";
    data.profesores[profesorActual].forEach((a,i)=>{
        const div = document.createElement("div");
        div.className="card alumno";
        div.innerHTML=`
            <h3>${a.nombre}</h3>

            <input type="number" placeholder="Metros nadados">
            <button>Agregar</button>

            <canvas id="chart${i}"></canvas>

            <textarea placeholder="Comentario para la pr칩xima clase" style="width:100%;height:60px;">${a.comentario}</textarea>
            <br>
            <button>游닌 Descargar PDF</button>
        `;
        cont.appendChild(div);

        const input = div.querySelector("input");
        const btnAdd = div.querySelectorAll("button")[0];
        const textarea = div.querySelector("textarea");
        const btnPDF = div.querySelectorAll("button")[1];

        btnAdd.onclick = ()=>{
            const val = Number(input.value);
            if(!val) return;
            a.registros.push({
                fecha: new Date().toLocaleDateString(),
                metros: val
            });
            input.value="";
            save();
            renderAlumnos();
        };

        textarea.onchange = ()=>{
            a.comentario = textarea.value;
            save();
        };

        drawChart(`chart${i}`, a.registros);

        btnPDF.onclick = ()=>{
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            pdf.text(`Alumno: ${a.nombre}`,10,10);
            let y=20;
            a.registros.forEach(r=>{
                pdf.text(`${r.fecha}: ${r.metros} m`,10,y);
                y+=8;
            });
            pdf.text("Comentario:",10,y+5);
            pdf.text(a.comentario || "-",10,y+13);
            pdf.save(`${a.nombre}.pdf`);
        };
    });
}

/* GRAFICA */
function drawChart(id, registros){
    const ctx = document.getElementById(id);
    if(!ctx) return;

    new Chart(ctx,{
        type:'line',
        data:{
            labels: registros.map(r=>r.fecha),
            datasets:[{
                label:'Metros nadados',
                data: registros.map(r=>r.metros),
                borderWidth:2,
                fill:false
            }]
        },
        options:{
            scales:{
                x:{ title:{ display:true, text:'Fecha' }},
                y:{ title:{ display:true, text:'Metros' }, beginAtZero:true }
            }
        }
    });
}
</script>

</body>
</html>
