<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Record_Pages</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f4f7;
    padding:20px;
}
.card{
    background:#fff;
    padding:15px;
    margin-bottom:15px;
    border-radius:8px;
    box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.hidden{display:none}
button,input,textarea{
    width:100%;
    padding:8px;
    margin:5px 0;
}
.alumno{
    border-left:6px solid #2196f3;
}
.top{
    display:flex;
    gap:10px;
}
.top input{flex:1}
canvas{margin-top:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
    <h2>Ingreso Profesor</h2>
    <input type="password" id="password" placeholder="ContraseÃ±a">
    <button onclick="login()">Ingresar</button>
</div>

<!-- PANEL -->
<div id="panel" class="hidden">
    <h2 id="profName"></h2>

    <div class="card top">
        <input type="text" id="search" placeholder="Buscar alumno..." oninput="renderAlumnos()">
        <button onclick="crearAlumno()">âž• Crear alumno</button>
    </div>

    <div id="alumnos"></div>
</div>

<script>
/* CONFIG */
const profesores = {
    prof1:"Profesor 1",
    prof2:"Profesor 2",
    prof3:"Profesor 3"
};
let profesorActual=null;

/* DATA */
let data = JSON.parse(localStorage.getItem("natacionData")) || {
    profesores:{ prof1:[], prof2:[], prof3:[] }
};

function save(){
    localStorage.setItem("natacionData", JSON.stringify(data));
}

/* LOGIN */
function login(){
    const pass = password.value;
    if(profesores[pass]){
        profesorActual = pass;
        login.classList.add("hidden");
        panel.classList.remove("hidden");
        profName.innerText = profesores[pass];
        renderAlumnos();
    }else alert("Clave incorrecta");
}

/* CREAR ALUMNO */
function crearAlumno(){
    data.profesores[profesorActual].push({
        nombre:"Alumno sin nombre",
        registros:[],
        comentario:""
    });
    save();
    renderAlumnos();
}

/* RENDER */
function renderAlumnos(){
    const cont = alumnos;
    cont.innerHTML="";
    const filtro = search.value.toLowerCase();

    data.profesores[profesorActual]
    .filter(a=>a.nombre.toLowerCase().includes(filtro))
    .forEach((a,i)=>{
        const div=document.createElement("div");
        div.className="card alumno";
        div.innerHTML=`
            <input value="${a.nombre}">
            <input type="number" placeholder="Metros nadados">
            <button>Agregar metros</button>
            <canvas id="c${i}"></canvas>
            <textarea placeholder="Comentario">${a.comentario}</textarea>
            <button>ðŸ“¥ PDF</button>
        `;
        cont.appendChild(div);

        const name=div.querySelectorAll("input")[0];
        const metros=div.querySelectorAll("input")[1];
        const add=div.querySelectorAll("button")[0];
        const txt=div.querySelector("textarea");
        const pdf=div.querySelectorAll("button")[1];

        name.onchange=()=>{a.nombre=name.value;save();renderAlumnos()};
        txt.onchange=()=>{a.comentario=txt.value;save()};

        add.onclick=()=>{
            if(!metros.value) return;
            a.registros.push({
                fecha:new Date().toLocaleDateString(),
                metros:Number(metros.value)
            });
            metros.value="";
            save();
            renderAlumnos();
        };

        setTimeout(()=>draw(`c${i}`,a.registros),0);

        pdf.onclick=()=>{
            const {jsPDF}=window.jspdf;
            const p=new jsPDF();
            p.text(`Alumno: ${a.nombre}`,10,10);
            let y=20;
            a.registros.forEach(r=>{
                p.text(`${r.fecha}: ${r.metros} m`,10,y); y+=8;
            });
            p.text("Comentario:",10,y+5);
            p.text(a.comentario||"-",10,y+13);
            p.save(`${a.nombre}.pdf`);
        };
    });
}

/* GRAFICA */
function draw(id,reg){
    const c=document.getElementById(id);
    if(!c) return;
    new Chart(c,{
        type:'line',
        data:{
            labels:reg.map(r=>r.fecha),
            datasets:[{
                label:'Metros',
                data:reg.map(r=>r.metros),
                borderWidth:2,
                tension:.3
            }]
        },
        options:{
            scales:{
                x:{title:{display:true,text:"Fecha"}},
                y:{title:{display:true,text:"Metros"},beginAtZero:true}
            }
        }
    });
}
</script>

</body>
</html>
